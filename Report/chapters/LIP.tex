\documentclass[main.tex]{subfiles}

\begin{document}

\section{LIP}\label{sec:lip_eugenio}
Eugenio:\\
This reduced model assumes that during the motion the Center of Mass (CoM) will have a constant height H.
\begin{equation}
    \dot{v}_{x} = \frac{g}{H}(p_{x} - f_{x})
    \qquad
    \dot{v}_{y} = \frac{g}{H}(p_{y} - f_{y})
\end{equation}
With $(p_{x}, p_{y})$ we denote the position of the CoM and with $(v_{x}, v_{y})$ its velocity with respect to the $x$-axis and $y$-axis. The stance foot position, which is the position in which both feets are in contact with the ground, is denoted with $(f_{x}, f_{y})$.

Given the position $(p_{x_{k}}, p_{y_{k}})$ and velocities $(v_{x_{k}}, v_{y_{k}})$ of the CoM at the $k$-th step, the closed-form solutions of the step-to-step discrete dynamics can be written as follows :
\begin{equation}
    \begin{bmatrix}
        p_{x_{k+1}} \\
        v_{x_{k+1}}
    \end{bmatrix}
    = A_{d}
    \begin{bmatrix}
        p_{x_{k}} \\
        v_{x_{k}}
    \end{bmatrix}
    + B_{d} f_{x_{k}}
    \qquad
    \begin{bmatrix}
        p_{y_{k+1}} \\
        v_{y_{k+1}}
    \end{bmatrix}
    = A_{d}
    \begin{bmatrix}
        p_{y_{k}} \\
        v_{y_{k}}
    \end{bmatrix}
    + B_{d} f_{y_{k}}
\end{equation}

Where $\beta = \sqrt{\frac{g}{H}}$ and the two matrices are:
\begin{equation}
    A_{d} = 
    \begin{bmatrix}
        cosh(\beta T) & \frac{sinh(\beta T)}{\beta} \\
        \beta sinh(\beta T) & cosh(\beta T)
    \end{bmatrix}
    \qquad
    B_{d} = 
    \begin{bmatrix}
        1 - cosh(\beta T) & - \beta sinh(\beta T)
    \end{bmatrix}
\end{equation}
By defining the state of our system as $x = [p_{x}, v_{x}, p_{y}, v_{y}, \theta]^T \in \mathbb{R}^5$ and the control input as $u = [f_{x}, f_{y}, \omega]^T \in \mathbb{R}^3$, where $\theta$ is the heading angle and $\omega$ is its turning rate, the step-to-step dynamics of the 3D-LIP model is written as follows:
\begin{equation}
    x_{k+1} = A_{L}x_{k} + B_{L}u_{k}
\end{equation}

Where the two matrices are defined as follows:
\begin{equation}
    A_{L} = 
    \begin{bmatrix}
        A_{d} & 0 & 0 \\
        0 & A_{d} & 0 \\
        0 & 0 & 1
    \end{bmatrix}
    \qquad
    B_{d} = 
    \begin{bmatrix}
        B_{d} & 0 & 0 \\
        0 & B_{d} & 0 \\
        0 & 0 & T
    \end{bmatrix}
\end{equation}




\section{3D-LIP Model with Heading Angles}\label{sec:lip}
Salvatore:\\
If the full dynamic model of the humanoid is used to simulate its motion, it becomes computationally impossible to perform joint path and gait planning, due to its high dimensionality and non-linearity. Therefore, a simplifying model must be used. For this scope Peng et al. introduced the "3D-LIP Model with Heading Angle", which describes the discrete dynamics of the Center of Mass (CoM) similarly to the one of an inverted pendulum in three dimensions.

\subsection{Local Robot Reference Frame}
The state $\mathbf{x}$ and the input $\mathbf{u}$ of the dynamic model are defined as:

$$ \mathbf{x} := \left( p_x,\; v_x,\; p_y,\; v_y,\; \theta \right)^T \in X \subset \mathbb{R}^5 , $$
$$ \mathbf{u} := \left( f_x,\; f_y,\; \omega \right)^T \in U \subset \mathbb{R}^3 , $$

where $(p_x, v_x)$ are the CoM position and translational velocity along the $x$-axis, $f_x$ is the $x$-coordinate of the stance foot position, $\theta$ and $\omega$ are the humanoid's orientation and turning rate, respectively. $X$ is the set of the allowed states, while $U$ is the set of the admissible inputs.\\
Both the state and the input are expressed in the local coordinates of the robot. It means that $(p_x, p_y)$ represents the position of the CoM in the reference frame (RF) that originates from the CoM position at the previous time step. The RF at the next time step will be rotated by an angle $\theta$ around the $z$-axis with respect to the previous frame. The relation between the vectors in different reference frames is represented in Figure \ref{fig:loc_to_glob_tfm}.\\
The reference frame at time step 0 is considered the "inertial" or "global" frame. A transformation between the inertial and moving frames is necessary to obtain the position of the humanoid in the global map and to deal with obstacles. Transformations are performed as follows:
$$
T_k = \begin{pmatrix}
\cos\theta_k & -\sin\theta_k & p_{x,\,k,\,\text{glob}} \\
\sin\theta_k & \cos\theta_k &  p_{y,\,k,\,\text{glob}} \\
0 & 0 & 1
\end{pmatrix},
$$

$$
\begin{pmatrix} f_{x,\,k,\,\text{glob} } \\ f_{y,\,k,\,\text{glob}} \\ 1 \end{pmatrix} = \; T_k \;
\begin{pmatrix}
f_{x,\,k,\,\text{loc} } \\ f_{y,\,k,\,\text{loc}} \\ 1
\end{pmatrix},
$$

$$
\begin{pmatrix} p_{x,\,k+1,\,\text{glob} } \\ p_{y,\,k+1,\,\text{glob}} \\ 1 \end{pmatrix} = \; T_k \;
\begin{pmatrix}
p_{x,\,k+1,\,\text{loc} } \\ p_{y,\,k+1,\,\text{loc}} \\ 1
\end{pmatrix},
$$

$$
\begin{pmatrix} v_{x,\,k+1,\,\text{glob} } \\ v_{y,\,k+1,\,\text{glob}}\end{pmatrix} = \; \begin{pmatrix} \cos\theta_k & -\sin\theta_k \\ \sin\theta_k & \cos\theta_k \end{pmatrix}\;
\begin{pmatrix}
v_{x,\,k+1,\,\text{loc} } \\ v_{y,\,k+1,\,\text{loc}}
\end{pmatrix},
$$

$$ 
\theta_{k+1, \text{glob}} = \theta_{k, \text{glob}} + \theta_{k+1, \text{loc}},
\qquad
\omega_{\text{glob}} = \omega_{\text{loc}}.
$$

The positional vectors are roto-translated using a $3\times3$ homogeneous matrix. The velocity vectors are only rotated around the z-axis (indeed, a translation would change their magnitude) using a rotation matrix. The global robot's orientation is obtained by summing the latest local variation to the previous global angle. The angular velocity does not need to be transformed because it is along the $z$-axis, which is fixed.

\begin{figure}
    \centering
    \includegraphics[width=1\linewidth]{figures/LIP/loc_to_glob_tfm.pdf}
    \caption{An example of the evolution of the 3D-LIP model's state, highlighting the relationship between local and global coordinates. The initial state is $\mathbf{0}$ and the RF $(x_0,\, y_0)$ is the inertial frame. The local RF translates and rotates: the position of the RF $(x_2,\, y_2)$ related to time step 1 is given by the position of $p_{1, \text{glob}}$, while its orientation is given by $\theta_{1, glob}$. The pose of the successive frames is computed analogously.}
    \label{fig:loc_to_glob_tfm}
\end{figure}

\subsection{Model Definition}

\end{document}